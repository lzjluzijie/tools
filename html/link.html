<section class="section" id="link">
    <div class="container">
        <div class="columns">

            <div class="column is-5">
                <div id="examples" class="content" style="word-wrap: break-word;">

                </div>
            </div>

            <div class="column is-5">
                <div class="control">
                    <input class="input" type="text" v-model="input" placeholder="Sharing URL here">
                </div>

                <br>

                <div class="content control">
                    <p id="output" class="content" v-bind:data-clipboard-text="output" style="word-wrap:break-word">
                        Direct URL: {{ output }}
                    </p>
                </div>
            </div>

        </div>

    </div>
</section>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.8/dist/vue.min.js"
        integrity="sha256-GN7NvWruk083BKn+djXpMOuWnd9Rz70hQgF868IIyTU=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js"
        integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@0.6.0/marked.min.js"
        integrity="sha256-ypJ65b+4BwdfsQtz1URdUBhJ9L5ijdovxTOdG+x5hsE=" crossorigin="anonymous"></script>
<script>

    var md = "R2V0IGRpcmVjdCBkb3dubG9hZCBsaW5rIGZyb20gc2hhcmluZyBsaW5rLCBjdXJyZW50bHkgc3VwcG9ydCBPbmVEcml2ZSwgU2hhcmVQb2ludCwgYW5kIEdvb2dsZSBEcml2ZS4KCkhlcmUgYXJlIHNvbWUgZXhhbXBsZXMuCgp8IE5hbWUgICAgICAgICB8IFNoYXJpbmcgVVJMICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IERpcmVjdCBVUkwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8CnwgLS0tLS0tLS0tLS0tIHwgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHwgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHwKfCBPbmVEcml2ZSAgICAgfCBodHRwczovLzFkcnYubXMvdS9zIUFnbG1OejVwelJ0MW1nNmE3Y3EtR2hpLTBoMkQgICAgICAgICAgICAgfCBodHRwczovL2FwaS5vbmVkcml2ZS5jb20vdjEuMC9zaGFyZXMvdSFhSFIwY0hNNkx5OHhaSEoyTG0xekwzVXZjeUZCWjJ4dFRubzFjSHBTZERGdFp6WmhOMk54TFVkb2FTMHdhREpFL3Jvb3QvY29udGVudCB8CnwgU2hhcmVQb2ludCAgIHwgaHR0cHM6Ly9sempsdXppamllLW15LnNoYXJlcG9pbnQuY29tLzppOi9nL3BlcnNvbmFsLzZ0dV9sempsdXppamllX29ubWljcm9zb2Z0X2NvbS9FYmMtT1VEZlVlTkVoa082RGg1NTlVNEJrQ3NnWXg1N3lUalpXSjUwTEpsMXNnP2U9MERrejVKIHwgaHR0cHM6Ly9sempsdXppamllLW15LnNoYXJlcG9pbnQuY29tLzppOi9nL3BlcnNvbmFsLzZ0dV9sempsdXppamllX29ubWljcm9zb2Z0X2NvbS9FYmMtT1VEZlVlTkVoa082RGg1NTlVNEJrQ3NnWXg1N3lUalpXSjUwTEpsMXNnP2U9MERrejVKJmRvd25sb2FkPTEgfAp8IEdvb2dsZSBEcml2ZSB8IGh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS9vcGVuP2lkPTFRWFc3RkRqbGIzdUxza1VrWnhhWUp1NTVVUUk3U2hMMCB8IGh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9leHBvcnQ9ZG93bmxvYWQmaWQ9MVFYVzdGRGpsYjN1THNrVWtaeGFZSnU1NVVRSTdTaEwwIHwK"
    document.getElementById("examples").innerHTML = marked(window.atob(md));
    document.getElementsByTagName("table")[0].style.setProperty("table-layout", "fixed");

    var link = new Vue({
        el: '#link',
        data: {
            input: '',
        },
        computed: {
            output: function () {
                try {
                    let input = this.input;
                    let url = new URL(input);
                    let host = url.host;

                    //SharePoint
                    if (host.slice(-14) === "sharepoint.com") {
                        url.searchParams.set("download", "1");
                        return url.toString()
                    }

                    //OneDrive
                    if (host === "1drv.ms" || host === "onedrive.live.com") {
                        return "https://api.onedrive.com/v1.0/shares/u!" + window.btoa(input).replace(/\+/g, '-').replace(/\//g, '_').replace(/\=+$/, '') + "/root/content"
                    }

                    //Google Drive
                    if (host === "drive.google.com") {
                        let id = url.searchParams.get("id");
                        if (id != null) {
                            alert(id);
                            return "https://drive.google.com/uc?export=download&id=" + id
                        }

                        if (input.slice(0, 32) === "https://drive.google.com/file/d/") {
                            return "https://drive.google.com/uc?export=download&id=" + input.slice(32).split("/")[0]
                        }

                        return "google drive error, check the example"
                    }

                    //error
                    return "unknown url"
                } catch (e) {
                    return ""
                }
            }
        },
    });

    new ClipboardJS(document.getElementById('output'));
</script>