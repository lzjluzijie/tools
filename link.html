<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.4/css/bulma.min.css"
          integrity="sha256-8B1OaG0zT7uYA572S2xOxWACq9NXYPQ+U5kHPV1bJN4=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.7.2/css/all.min.css"
          integrity="sha256-7V33osRIfrDP7o1DzMbHKTFApfEDTIyCywe0imdN8no=" crossorigin="anonymous">
    <title>Tools by Halulu</title>
    <meta name="keywords" content="哈陆lu,halulu,tools,online,hash">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-91028451-12"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'UA-91028451-12');
    </script>

</head>
<body>
<nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            <img alt="halulu" src="https://halu.lu/favicon-32x32.png"><strong>Tools</strong>
        </a>
    </div>

    <div id="navbar-menu" class="navbar-menu">
        <div class="navbar-start">
            <a class="navbar-item" id="navbar-hash" href="/hash.html">
                Hash
            </a>

            <a class="navbar-item" id="navbar-hash" href="/encode.html">
                Encode
            </a>

            <a class="navbar-item" id="navbar-hash" href="/link.html">
                Link
            </a>
        </div>

        <div class="navbar-end">
            <a class="navbar-item" id="navbar-todo" href="/todo.html">
                TODO
            </a>

            <a class="navbar-item" id="navbar-halulu" href="https://halu.lu/"
               target="_blank">Halulu</a>

            <div class="navbar-item" id="navbar-github">
                <a href="https://github.com/lzjluzijie/tools">
                    <i class="fab fa-github fa-2x"></i>
                </a>
            </div>
        </div>
    </div>
</nav>
<section class="section" id="link">
    <div class="container">
        <div class="columns">

            <div class="column is-5">
                <div class="control">
                    <input class="input" type="text" v-model="sharingURL" placeholder="Sharing URL here">
                </div>

                <br>

                <div class="content control">
                    <p id="directURL" class="content" v-bind:data-clipboard-text="directURL"
                       style="word-wrap:break-word">
                        Direct URL: {{ directURL }}
                    </p>
                </div>

                <div id="examples" class="content" style="word-wrap: break-word;">

                </div>
            </div>

            <div class="column is-5">

                <div class="control">
                    <input class="input" type="text" v-model="longURL" placeholder="Long URL here">
                </div>

                <br>

                <div class="content control">
                    <p id="shortURL" class="content" v-bind:data-clipboard-text="shortURL" style="word-wrap:break-word">
                        Short URL: {{ shortURL }}
                    </p>
                </div>

            </div>

        </div>

    </div>
</section>
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.8/dist/vue.min.js"
        integrity="sha256-GN7NvWruk083BKn+djXpMOuWnd9Rz70hQgF868IIyTU=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js"
        integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@0.6.0/marked.min.js"
        integrity="sha256-ypJ65b+4BwdfsQtz1URdUBhJ9L5ijdovxTOdG+x5hsE=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/axios@0.18.0/dist/axios.min.js"
        integrity="sha256-mpnrJ5DpEZZkwkE1ZgkEQQJW/46CSEh/STrZKOB/qoM=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"
        integrity="sha256-7/yoZS3548fXSRXqc/xYzjsmuW3sFKzuvOCHd06Pmps=" crossorigin="anonymous"></script>
<script>
    var md = "R2V0IGRpcmVjdCBkb3dubG9hZCBsaW5rIGZyb20gc2hhcmluZyBsaW5rLCBjdXJyZW50bHkgc3VwcG9ydCBPbmVEcml2ZSwgU2hhcmVQb2ludCwgYW5kIEdvb2dsZSBEcml2ZS4KCkhlcmUgYXJlIHNvbWUgZXhhbXBsZXMuCgp8IE5hbWUgICAgICAgICB8IFNoYXJpbmcgVVJMICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IERpcmVjdCBVUkwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8CnwgLS0tLS0tLS0tLS0tIHwgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHwgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIHwKfCBPbmVEcml2ZSAgICAgfCBodHRwczovLzFkcnYubXMvdS9zIUFnbG1OejVwelJ0MW1nNmE3Y3EtR2hpLTBoMkQgICAgICAgICAgICAgfCBodHRwczovL2FwaS5vbmVkcml2ZS5jb20vdjEuMC9zaGFyZXMvdSFhSFIwY0hNNkx5OHhaSEoyTG0xekwzVXZjeUZCWjJ4dFRubzFjSHBTZERGdFp6WmhOMk54TFVkb2FTMHdhREpFL3Jvb3QvY29udGVudCB8CnwgU2hhcmVQb2ludCAgIHwgaHR0cHM6Ly9sempsdXppamllLW15LnNoYXJlcG9pbnQuY29tLzppOi9nL3BlcnNvbmFsLzZ0dV9sempsdXppamllX29ubWljcm9zb2Z0X2NvbS9FYmMtT1VEZlVlTkVoa082RGg1NTlVNEJrQ3NnWXg1N3lUalpXSjUwTEpsMXNnP2U9MERrejVKIHwgaHR0cHM6Ly9sempsdXppamllLW15LnNoYXJlcG9pbnQuY29tLzppOi9nL3BlcnNvbmFsLzZ0dV9sempsdXppamllX29ubWljcm9zb2Z0X2NvbS9FYmMtT1VEZlVlTkVoa082RGg1NTlVNEJrQ3NnWXg1N3lUalpXSjUwTEpsMXNnP2U9MERrejVKJmRvd25sb2FkPTEgfAp8IEdvb2dsZSBEcml2ZSB8IGh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS9vcGVuP2lkPTFRWFc3RkRqbGIzdUxza1VrWnhhWUp1NTVVUUk3U2hMMCB8IGh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9leHBvcnQ9ZG93bmxvYWQmaWQ9MVFYVzdGRGpsYjN1THNrVWtaeGFZSnU1NVVRSTdTaEwwIHwK"
    document.getElementById("examples").innerHTML = marked(window.atob(md));
    document.getElementsByTagName("table")[0].style.setProperty("table-layout", "fixed");

    var link = new Vue({
        el: '#link',
        data: {
            sharingURL: '',
            longURL: '',
            shortURL: '',
        },
        computed: {
            directURL: function () {
                try {
                    let sharingURL = this.sharingURL;
                    let url = new URL(sharingURL);
                    let host = url.host;

                    //SharePoint
                    if (host.slice(-14) === "sharepoint.com" || host.slice(-13) === "sharepoint.cn") {
                        url.searchParams.set("download", "1");
                        return url.toString()
                    }

                    //OneDrive
                    if (host === "1drv.ms" || host === "onedrive.live.com") {
                        return "https://api.onedrive.com/v1.0/shares/u!" + window.btoa(sharingURL).replace(/\+/g, '-').replace(/\//g, '_').replace(/\=+$/, '') + "/root/content"
                    }

                    //Google Drive
                    if (host === "drive.google.com") {
                        let id = url.searchParams.get("id");
                        if (id != null) {
                            alert(id);
                            return "https://drive.google.com/uc?export=download&id=" + id
                        }

                        if (sharingURL.slice(0, 32) === "https://drive.google.com/file/d/") {
                            return "https://drive.google.com/uc?export=download&id=" + sharingURL.slice(32).split("/")[0]
                        }

                        return "google drive error, check the example"
                    }

                    //error
                    return "unknown url"
                } catch (e) {
                    return "invalid url"
                }
            }
        },
        created: function () {
            this.debouncedGetWeiboShortURL = _.debounce(this.getWeiboShortURL, 500)
            this.debouncedGetBaiduShortURL = _.debounce(this.getBaiduShortURL, 500)
        },
        watch: {
            longURL: function () {
                this.shortURL = "requesting...";
                this.debouncedGetBaiduShortURL()
            }
        },
        methods: {
            getWeiboShortURL: function () {
                try {
                    let longURL = this.longURL;
                    let url = new URL(longURL);
                    axios.get('https://api.weibo.com/2/short_url/shorten.json', {
                        params: {
                            source: 569452181,
                            url_long: longURL,
                        }
                    }).then(function (response) {
                        console.log(response);
                        link.shortURL = response.urls[0].url_short
                    }).catch(function (error) {
                        link.shortURL = error
                    })
                } catch (e) {
                    this.shortURL = "invalid url"
                }
            },
            getBaiduShortURL: function () {
                try {
                    let longURL = this.longURL;
                    let url = new URL(longURL);
                    axios.post('https://dwz.cn/admin/v2/create', {
                        url: longURL,
                    }, {
                        headers: {
                            Token: '3b5ad7e2cf3334ec0122d39aea8a970c',
                        }
                    }).then(function (response) {
                        console.log(response);
                        link.shortURL = response.data.ShortUrl
                    }).catch(function (error) {
                        link.shortURL = error
                    })
                } catch (e) {
                    this.shortURL = "invalid url"
                }
            }
        }
    });

    new ClipboardJS(document.getElementById('directURL'));
</script>
</body>
</html>